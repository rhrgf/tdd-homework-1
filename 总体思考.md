# WiFi室内导航设计

## 设计思路

1. 用户处于三维空间，可能需考虑高度+平面坐标来确定用户位置。
2. 根据事先输入的地图，将目的地抽象为点，采用最短路算法获得到达平面目标的线路，并在行进过程中不断验证是否偏离规划路线，及时做矫正
    - 如需上下楼层，需先计算到达平面内楼梯最短路，再计算楼梯口到另一楼层目标位置的最短路

### 高度确定

1. 高度精确到楼层
    - 每层AP SSID 加入楼层标记，检测当前范围内信号最强的几个SSID即可获得楼层信息。

2. 高度数据需要再具体一些
    - 类似于平面定位做法，由圆形计算改为球形计算方法
    - 或考虑在上下楼道各安装一个AP，采用圆形计算来获得更准确的高度信息

### 平面位置确定

1. 将与AP的距离和此距信号强度的关系式拟合出来，并确定定位精度
2. 确定平面参考系，和AP位置坐标记录下来，AP分布尽量均匀
    - 若不均匀，部分信号较弱位置定位精度会下降
3. 根据接收到的WiFi信号确定用户平面位置
    - 若范围内SSID少于3个则无法精确确定用户位置，但若存在历史定位信息，可大致推断出用户较为可能的位置
        - 惯性导航
    - 若范围内SSID大于等于3，则取信号较强的3个进行计算，反复照此方式计算多次，取数值较为集中出现的值
        - 以已知的AP位置作为圆心，根据关系式将信号强度转换成的距离为半径画圆，三圆交于一点即为用户位置。
        - 反复计算多次是为了防止部分信号穿墙使得先前获得的关系式不再适用的问题

## 测试用例

### 信号强度与距离的关系式确定的测试用例

1. 不同距离测试关系式是否正确
2. AP疏密分布，定位精度的确定
3. 隔楼层信号强度与距离的关系验证

### 定位测试用例

1. 已知AP坐标以及AP距离测试定位能力
2. 有墙体平面条件下，能否根据多信源综合定位
3. 平面移动测试，由密集分布到稀疏分布，测试惯性导航，及计算能力。
4. 高度移动测试，上下楼层测量高度。
5. 惯性定位

### 地图寻路测试用例

1. 出发位置和目的地位置重合
2. 出发位置和目的地位置仅差楼层数
3. 其他出发位置和目的地位置组合测试

### 导航测试用例

1. 移动目标定位测试
2. 出发位置和目的地位置仅在视距内（测试定位精度）
3. 出发位置和目的地位置隔墙
4. 行进路径偏离规划路径
5. 惯性导航测试
